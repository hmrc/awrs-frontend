@import play.twirl.api.Html
@import uk.gov.hmrc.play.views.html.helpers._
@import models._
@import models.FormBundleStatus._
@import views.html.helpers._
@import views.helpers._
@import controllers.util.UnSubmittedChangesBannerParam
@import utils.AwrsNumberFormatter
@(
    awrsRef: Option[String],
    hasApplicationChanged: Boolean,
    allSectionComplete: Boolean,
    showOneViewLink: Boolean,
    businessName: String,
    indexStatusModel: view_models.IndexViewModel,
    someStatus: Option[SubscriptionStatusType],
    isHappyPathEnrollment: Boolean
)(implicit request: Request[AnyRef], messages: Messages )

@changesBanner = {
    @awrsUnSubmittedBanner(
        UnSubmittedChangesBannerParam(
            hasAwrs = awrsRef.isDefined,
            hasApplicationChanged = hasApplicationChanged,
            allSectionComplete = allSectionComplete
        ),
        Messages("awrs.index_page.modified_application_incomplete.index"),
        Messages("awrs.index_page.not_submitted_changes")
    )
}

@pageHeading = @{
    Messages("awrs.index_page.top_heading", businessName)
}


@includes.awrs_main(title = Messages("awrs.generic.tab.title", pageHeading), nameBusiness = Some(businessName), userLoggedIn = true){

    <div class="grid">
       @changesBanner
        <div class="grid grid-2-3">
            <h1 id="index-top-heading" class="heading-xlarge">@pageHeading</h1>

            <h3 class="heading-medium" id="application-status">
                <br>
                @someStatus match {
                    case Some(status) => {
                        <a id="status-page_link" href="@routes.ApplicationStatusController.showStatus(false)">@status.formBundleStatus.name @Messages("awrs.index_page.application_status_text")</a>
                        @if(status.formBundleStatus.name == Pending.name){
                            <br><br><a id="withdraw_link" href="@routes.WithdrawalController.showWithdrawalReasons">@Messages("awrs.index_page.withdraw_link")</a>
                        }
                    }
                    case None => {
                        @Messages("awrs.index_page.draft") @Messages("awrs.index_page.application_status_text")
                    }
                }
            </h3>

            @someStatus match {
                case Some(status) => {
                    @status.formBundleStatus match {
                        case Approved | ApprovedWithConditions => {
                            @awrsRef match {
                                case Some(ref) => {
                                    <p id="awrsRefNo">@Messages("awrs.index_page.awrs_ref")<br>@{AwrsNumberFormatter.format(ref)}</p>
                                }
                                case _ => {}
                            }
                            <p class="font-xsmall">
                                <a id="de_reg_page_link" href="@routes.DeRegistrationController.showReason">@Messages("awrs.index_page.de_registration_link")</a>
                            </p>
                        }
                        case _ => {}
                    }

                }
                case _ => {}
            }
            @if(showOneViewLink) {
                <div class="form-group">
                    <a id="view-application"
                    data-journey-click="view-print-application-index-page:click:print"
                    href="@controllers.routes.ViewApplicationController.show(false)">
                    @Messages("awrs.generic.print_application")
                    </a>
                </div>
            }

            @if(!isHappyPathEnrollment) {
                <p id="applicationInfo" class="lede">@Messages("awrs.index_page.topText")</p>
            }

            <div class="form-group" id="index-form">
                <div class="index-data-row">
                        <h3 class="heading-medium data-title">@Messages("awrs.index_page.section_text")</h3>
                        <h3 class="heading-medium data-title">@Messages("awrs.index_page.status_text")</h3>
                </div>
                @indexStatusModel.sectionModels.zipWithIndex.map { case (i, id) =>
                <div class="index-data-row">
                    <p id="@i.id"> @{id+1}.
                        <a id="@{i.id + "_link"}" href="@i.href">
                            @Messages(i.text)
                            @i.size match {
                                case Some(size) => {&nbsp;(@size)<span class="visuallyhidden">entries</span>}
                                case _ => {}
                            }
                        </a>
                    </p>
                    <p class="awrs-status">
                        <span id="@{i.id + "_status"}" class="@Messages({i.status + "_class"})">
                            @Messages(i.status.messagesKey)
                        </span>
                    </p>
                </div>
                }
            </div>
            @awrsRef match {
                case Some(_) => {
                    @if(hasApplicationChanged && allSectionComplete) {
                        <a href="@routes.EmailVerificationController.checkEmailVerification" class="button" role="button" id="submit_changes">@Messages("awrs.index_page.submit_changes")</a>
                    }
                }
                case _ => {
                    @if(allSectionComplete) {
                        <a href="@routes.EmailVerificationController.checkEmailVerification" class="button" role="button" id="continue">@Messages("awrs.confirmation.button")</a>
                    } else {
                        <a href="@routes.ApplicationController.logout" class="button" role="button" id="save_and_logout">@Messages("awrs.generic.alternate_logout.button")</a>
                    }
                }
            }
        </div>
    </div>
}
